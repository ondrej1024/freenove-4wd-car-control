<!doctype html>
<html>
    <head>
        <title>Freenove 4WD Car</title>
        <style>
            .myData {
                text-align: center;
                color: #ffffff;
                font-family: sans-serif;
                font-size: 40px;
                font-weight: bold;
            }
            .myStatus {
                text-align: left;
                color: #ffffff;
                font-family: sans-serif;
                font-size: 16px;
                font-weight: normal;
            }
            .button {
                background-color: #04AA6D;
                border: none;
                color: white;
                padding: 15px 15px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 18px;
                margin: 0px 0px;
                cursor: pointer;
                width: 110px;
                height: 110px;
            }
        </style>

        <script>
            let ws_service;
            setInterval(sendPing, 1000);
            /*
            append = function (text) {
                document
                    .getElementById("websocket_events")
                    .insertAdjacentHTML("beforeend", "<li>" + text + ";</li>");
            };
            */
            window.onload = function () {
                ws_service = new WebSocket("ws://robocar.local:80/ws");
                //ws_service = new WebSocket("ws://192.168.1.85:5000/ws");
                ws_service.onmessage = function (event) {
                    data = JSON.parse(event.data)
                    let batt_val = document.getElementById("batt_val");
                    let dist_val = document.getElementById("dist_val");
                    let trck_val = document.getElementById("trck_val");
                    let lite_val = document.getElementById("lite_val");
                    let stat_val = document.getElementById("stat_val");
                    batt_val.innerHTML = data.data[0]+"%";
                    dist_val.innerHTML = data.data[1]+"cm";
                    trck_val.innerHTML = data.data[2][0]+" | "+data.data[2][1]+" | "+data.data[2][2];
                    lite_val.innerHTML = data.data[3][0]+"/"+data.data[3][1]+"%";
                    stat_val.innerHTML = "Connected to "+data.net[0]+" on network "+data.net[3]+" with signal strenght "+data.net[2];
                };
                ws_service.onopen = function () {
                    let stat_val = document.getElementById("stat_val");
                    stat_val.innerHTML = "Connected"
                };
                ws_service.onclose = function () {
                    let stat_val = document.getElementById("stat_val");
                    stat_val.innerHTML = "Disconnected"
                };
                ws_service.onerror = function () {
                    let stat_val = document.getElementById("stat_val");
                    stat_val.innerHTML = "Connection error"
                };
            };

            function sendCommand(cmd) {
                ws_service.send(cmd);
            }

            function sendPing() {
                ws_service.send("ping");
            }

        </script>
    </head>
    <body>
        <main class="container">

        <!-- Value display -->
        <table style="width: 680px;">
            <tbody>
                <tr>
                    <td style="width: 170px; background-color: lightblue;">
                        <p><span style="color: #ffffff; font-family: sans-serif;">Battery</span></p>
                        <div id="batt_val" class="myData">--</div>
                    </td>
                    <td style="width: 170px; background-color: lightblue;">
                        <p><span style="color: #ffffff; font-family: sans-serif;">Distance</span></p>
                        <div id="dist_val" class="myData">--</div>
                    </td>
                    <td style="width: 170px; background-color: lightblue;">
                        <p><span style="color: #ffffff; font-family: sans-serif;">Track</span></p>
                        <div id="trck_val" class="myData">--</div>
                    </td>
                    <td style="width: 170px; background-color: lightblue;">
                        <p><span style="color: #ffffff; font-family: sans-serif;">Light source</span></p>
                        <div id="lite_val" class="myData">--</div>
                    </td>
                </tr>
            </tbody>
        </table>
        </br>

        <!-- Nav buttons -->
        <table>
            <tbody>
                <tr>
                    <td align="center"><button class="button" type="button" onclick="sendCommand('turnleft')">Turn Left</button></td>
                    <td align="center"><button class="button" type="button" onclick="sendCommand('forward')">Forward</button></td>
                    <td align="center"><button class="button" type="button" onclick="sendCommand('turnright')">Turn Right</button></td>
                    <td rowspan=3 style="width: 340px">
                    <img src="https://store.freenove.com/cdn/shop/files/FNK0089C.MAIN.jpg" width="320" height="320">
                    </td>
                </tr>
                <tr>
                    <td align="center"><button class="button" type="button" onclick="sendCommand('spinleft')">Spin Left</button></td>
                    <td align="center"><button class="button" type="button" onclick="sendCommand('stop')">Stop</button></td>
                    <td align="center"><button class="button" type="button" onclick="sendCommand('spinright')">Spin Right</button></td>
                </tr>
                <tr>
                    <td></td>
                    <td align="center"><button class="button" type="button" onclick="sendCommand('backward')">Backward</button></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        </br>

        <!-- Status display -->
        <table style="width: 680px;">
            <tbody>
                <tr>
                    <td style="width: 680px; background-color: lightgrey;">
                        <div id="stat_val" class="myStatus">Initializing connection</div>
                    </td>
                </tr>
            </tbody>
        </table>

        </main>
    </body>
</html>
